<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Odes</title>
        <link rel = "stylesheet" type="text/css" href="./css/main.css">
        <link rel = "stylesheet" type="text/css" href="./css/schoolPage.css">

    </head>
    <body>
        <!--Barra de ferramentas-->
        <div class = "header">
            <nav class = "nav_bar">
                <ul class = "barGroup">
                    <li class = "navBarItem"><img class="iconeNav" src  = "img/arrowBack.png"></li>
                    <li class = "navBarItem">Configurações</li>
                    <li class = "navBarItem">Sobre</li>
                    <li class = "navBarItem">Ajuda</li>
                </ul>
            </nav>
        </div>

        <!--Barra com superior-->
        <div class = "container barraSuperior">
            <h1 class = "nomeTabela"></h1>
        </div>

        <!--Alunos-->
        <div class = "mainContainer">
            <div id = "container" class = "tabelaAlunos">
                <div class = "alunoGroup">
                    <div class = "dadoAlunos">
                        <p>Nome do aluno da Silva</p>
                        <p>M</p>
                        <p>3°A</p>
                        <p>Professora</p>
                        <p>Def. do aluno - CID</p>
                    </div>
                    <div class = "acoesAluno">
                        <button onclick="plusButton(12)"><img src="img/plus.svg"></button>
                        <button><img src="img/relatory.svg"></button>
                        <button><img src="img/edit.svg"></button>
                        <button><img src="img/triangulo.svg"></button>
                    </div>
                    <div id = "12" class = "plusArea">
                        <div class = "opButtons">
                            <button onclick="sendRelatory()">Salvar</button>
                            <button onclick="plusButton()">Cancelar</button>
                        </div>
                        <div id = "addRelatory" class = "inputContainer">
                            <textarea rows="6" id="add12" style="width: 99%" value=""></textarea>
                        </div>
                    </div> 
                </div>
                
            </div>
        </div>
    </body>

    <script src="js/iniciaObjetos.js"></script>

    <script>
        const contr = require(path.concat("/libs/objects"));
        let construtorAlunos = contr.construtorAlunos;
        let construtor = new construtorAlunos();//constroi objetos HTML
        
        //tempo para iniciar a aplicacao
        setTimeout(() => { init(); }, 1000);//  (?)     FAZER LOOP TENTANDO + PAG CARREGANDO 

        function init(){  
            //PEGAR ESCOLA DA PAGINA ANTERIOR
            let res = alunos.consultData({'escola': 'Escola Aleatoria 1'}, 'nome');
            let cont = document.getElementById("container");
            //adiciona os objetos dos alunos na pagina em ordem
            for(let i = 0; i < Object.keys(res).length; i++)
                cont.appendChild(construtor.builAlunos(res[i]));
        }
    </script>

    <script>
        function plusButton(id)
        {
            var ele = ('plus').concat(id);
            var x = document.getElementById(ele);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }

        function sendRelatory(id)
        {
            //pega o id do aluno
            let newRel = new relatorioData;
            newRel.id = id;
            //pega o horario do relatorio
            var today = new Date();
            var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
            var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
            var dateTime = date+' '+time;
            newRel.tempo = dateTime;
            //pega o texto do relatorio
            var ele = ('add').concat(id);
            var textarea = document.getElementById(ele);
            newRel.texto = textarea.value;
            //salva
            relatorio.sendData(newRel);
            plusButton(id);//fecha janela
        }
    </script>
</html>